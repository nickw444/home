utility_meter:
  mains_energy_consumed_quarterly:
    source: sensor.inverter_total_imported_energy
    unique_id: "mains_energy_consumed_quarterly"
    cycle: quarterly
  mains_energy_consumed_weekly:
    source: sensor.inverter_total_imported_energy
    unique_id: "mains_energy_consumed_weekly"
    cycle: weekly
  mains_energy_consumed_daily:
    source: sensor.inverter_total_imported_energy
    unique_id: "mains_energy_consumed_daily"
    cycle: daily

  mains_energy_exported_quarterly:
    source: sensor.inverter_total_exported_energy
    unique_id: "mains_energy_exported_quarterly"
    cycle: quarterly
  mains_energy_exported_weekly:
    source: sensor.inverter_total_exported_energy
    unique_id: "mains_energy_exported_weekly"
    cycle: weekly
  mains_energy_exported_daily:
    source: sensor.inverter_total_exported_energy
    unique_id: "mains_energy_exported_daily"
    cycle: daily

  air_conditioning_energy_consumed_quarterly:
    source: sensor.air_conditioning_energy
    unique_id: "air_conditioning_energy_consumed_quarterly"
    cycle: quarterly
  air_conditioning_energy_consumed_weekly:
    source: sensor.air_conditioning_energy
    unique_id: "air_conditioning_energy_consumed_weekly"
    cycle: weekly
  air_conditioning_energy_consumed_daily:
    source: sensor.air_conditioning_energy
    unique_id: "air_conditioning_energy_consumed_daily"
    cycle: daily

template:
  - sensor:
      - name: "Air Conditioning Power"
        unique_id: "air_conditioning_power_adjusted"
        unit_of_measurement: W
        device_class: power
        state_class: measurement
        availability: >
          {{ has_value('sensor.air_conditioning_power_raw') }}
        state: >
          {% if states('sensor.air_conditioning_power_raw')|float|abs > 10 %}
            {{ states('sensor.air_conditioning_power_raw') }}
          {% else %}
          0
          {% endif %}

      - name: "Mains Power Instantaneous Cost"
        unique_id: "mains_power_instantaneous_cost"
        unit_of_measurement: c/h
        state_class: measurement
        availability: >
          {{ has_value('sensor.inverter_meter_power') 
            and has_value('sensor.amber_general_price')
            and has_value('sensor.amber_feed_in_price') }}
        state: >
          {% if states('sensor.inverter_meter_power')|float >= 0 %}
          {{ (states('sensor.amber_general_price')|float * 100 * states('sensor.inverter_meter_power')|float / 1000) | round(2) }}
          {% else %}
          {{ (states('sensor.amber_feed_in_price')|float * 100 * states('sensor.inverter_meter_power')|float / 1000) | round(2) }}
          {% endif %}

      - name: "Mains Net Energy Cost Today"
        unique_id: "net_energy_cost_today"
        icon: "mdi:cash"
        unit_of_measurement: AUD
        state_class: measurement
        device_class: monetary
        availability: >
          {{ has_value('sensor.inverter_total_imported_energy_cost') 
            and has_value('sensor.inverter_total_exported_energy_compensation') }}
        state: >
          {{ states('sensor.inverter_total_imported_energy_cost')|float - states('sensor.inverter_total_exported_energy_compensation')|float }}
