id: "1600774623357"
alias: "blinds: open the blinds on first motion detected, once per day, after sunrise"
description: ""
trigger:
  - platform: time
    at: 09:00:00
  - type: motion
    platform: device
    device_id: 42d8cbc5f64e490c996b0dd2d70c8681
    entity_id: binary_sensor.living_room_motion_occupancy
    domain: binary_sensor
condition:
  - condition: template
    value_template:
      "{{ state_attr('automation.open_blinds_on_motion', 'last_triggered')
      < now().replace(hour=3, minute=0, second=0) }}"
  - condition: state
    entity_id: group.all_people
    state: home
  - condition: state
    entity_id: input_boolean.guest_mode
    state: "off"
  - condition: sun
    after: sunrise
action:
  # Handle the case where no motion has been detected, perhaps it's a public
  # holiday and wanted a sleep in. If no motion since dawn, then delay until
  # motion has been detected.
  - choose:
      - conditions:
          - condition: numeric_state
            entity_id: sensor.internal_motion_occupancy_since_dawn
            below: "1"
        sequence:
          - wait_for_trigger:
              - platform: numeric_state
                entity_id: sensor.internal_motion_occupancy_since_dawn
                above: "0"
            timeout: "02:00:00" # Wait for up to two hours (11:00am), then continue
            continue_on_timeout: true
  - service: cover.open_cover
    data: {}
    entity_id:
      - cover.living_room_blockout
      - cover.living_room_day
      - cover.study_blockout
mode: single
